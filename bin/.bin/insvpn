#!/bin/bash

# Keychain label
LABEL="insvpn"

# Get credentials from keychain
VPN_USERNAME=$(security find-generic-password -s "$LABEL" | grep -i '"acct"<blob>=' | cut -d'=' -f2 | cut -d'"' -f2)
VPN_GROUP=$(security find-generic-password -a "$VPN_USERNAME" -s "$LABEL" | grep -i '"icmt"<blob>=' | cut -d'=' -f2 | cut -d'"' -f2)
VPN_PASSWORD=$(security find-generic-password -w -a "$VPN_USERNAME" -s "$LABEL")

sudo -v -p "Sudo password: " 
printf '%s\n' "$VPN_PASSWORD" "$VPN_TOKEN" | sudo openconnect vpn.ins.hsr.ch --authgroup="$VPN_GROUP" -u "$VPN_USERNAME"